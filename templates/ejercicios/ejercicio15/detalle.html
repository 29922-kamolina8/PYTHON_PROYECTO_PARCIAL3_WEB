{% extends "base.html" %}
{% block title %}{{ ejercicio.titulo }} ¬∑ Python Academy{% endblock %}

{% block content %}

<style>
  .hero-ej{
    background:#f8fafc;
    border-bottom:1px solid rgba(0,0,0,.08);
    padding:52px 0;
  }
  .hero-ej .badge{border-radius:999px;padding:8px 14px;font-weight:700;}
  .hero-ej h1{font-weight:800;letter-spacing:-.02em;}
  .hero-ej p{max-width:920px;margin:0 auto;}

  .hero-top-actions{
    display:flex;
    justify-content:center;
    margin-bottom:14px;
  }
  .btn-pill{border-radius:999px;padding:10px 22px;font-weight:700;}
  .btn-pill-sm{border-radius:999px;padding:8px 16px;font-weight:700;}

  .ej-wrap{padding:36px 0 70px;}
  .ej-panel{
    border-radius:18px;border:1px solid rgba(0,0,0,.08);
    box-shadow:0 10px 25px rgba(0,0,0,.05);
    background:#fff;padding:26px;
  }

  .ej-actions{
    margin-top:18px;padding-top:18px;
    border-top:1px solid rgba(0,0,0,.08);
    display:flex;justify-content:center;
  }

  .form-shell{margin-top:22px;display:flex;justify-content:center;}
  .form-card{
    width:100%;max-width:720px;
    border-radius:18px;border:1px solid rgba(0,0,0,.08);
    box-shadow:0 10px 25px rgba(0,0,0,.06);
    background:#fff;padding:22px;
  }
  .form-card *{max-width:100%;}

  .ej-nav-bottom{
    margin-top:26px;
    padding-top:18px;
    border-top:1px solid rgba(0,0,0,.08);
    display:flex;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }
  .ej-nav-bottom .btn{ min-width: 170px; }

  .explain-card{
    border:1px solid rgba(0,0,0,.08);
    border-radius:16px;
    padding:18px;
    background:#fbfdff;
  }

  .code-box{
    background:#0b1220;
    color:#e6edf3;
    border-radius:14px;
    padding:14px;
    overflow:auto;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 0.92rem;
    white-space: pre;
    margin: 0;
  }
  .hint{ font-size: .95rem; color:#556; }
</style>

<!-- HERO -->
<section class="hero-ej">
  <div class="container text-center">

    <div class="hero-top-actions">
      <a href="{{ url_for('ejercicios') }}" class="btn btn-outline-secondary btn-pill-sm">
        <i class="bi bi-arrow-left me-1"></i> Volver al men√∫
      </a>
    </div>

    <span class="badge bg-primary mb-3">{{ ejercicio.tema }}</span>
    <h1 class="display-5 mb-2">{{ ejercicio.titulo }}</h1>
    <p class="lead text-muted">{{ ejercicio.descripcion }}</p>
  </div>
</section>

<!-- CONTENIDO -->
<section class="ej-wrap">
  <div class="container">
    <div class="ej-panel">

      <!-- ‚úÖ ENUNCIADO (ABSTRACTA) -->
      <div class="explain-card mb-4">
        <h4 class="fw-bold mb-2">üß© Enunciado</h4>
        <p class="mb-2">
          En este ejercicio vamos a practicar <b>clases abstractas</b> en Python usando el m√≥dulo
          <code>abc</code>. Crearemos una clase abstracta llamada <b>Figura</b> que obligar√° a sus clases hijas
          (Cuadrado, Rect√°ngulo y Tri√°ngulo) a implementar m√©todos como <b>√°rea</b> y <b>per√≠metro</b>.
        </p>
        <p class="mb-0 hint">
          Adem√°s, vamos a integrar un formulario web en Flask para elegir el tipo de figura y enviar los lados
          por <b>POST</b>, y con eso calcular √°rea y per√≠metro.
        </p>
      </div>

      <!-- ‚úÖ EXPLICACI√ìN DETALLADA (ABSTRACTA) -->
      <div class="explain-card mb-4">
        <h4 class="fw-bold mb-3">üìå Explicaci√≥n del c√≥digo (paso a paso)</h4>

        <h5 class="fw-bold mb-2">1) Importaciones principales</h5>
        <pre class="code-box mb-2"><code>from abc import ABC, abstractmethod
from math import sqrt
from typing import Dict, Any
from flask import request, render_template_string</code></pre>
        <ul class="mb-3">
          <li><code>ABC</code> y <code>abstractmethod</code>: sirven para definir una clase abstracta y m√©todos obligatorios.</li>
          <li><code>sqrt</code>: ra√≠z cuadrada (se usa en el √°rea del tri√°ngulo con la f√≥rmula de Her√≥n).</li>
          <li><code>request</code>: permite leer datos enviados por el formulario con POST.</li>
          <li><code>render_template_string</code>: devuelve HTML como texto para mostrarlo en <code>detalle.html</code>.</li>
        </ul>

        <h5 class="fw-bold mb-2">2) ¬øQu√© es una clase abstracta y para qu√© sirve?</h5>
        <p class="mb-2">
          Una <b>clase abstracta</b> es una clase que sirve como ‚Äúmolde‚Äù o ‚Äúcontrato‚Äù:
          define qu√© m√©todos deben existir en las clases hijas, pero no obliga a tener una implementaci√≥n completa.
        </p>
        <div class="alert alert-info mb-3">
          En este ejercicio, <b>Figura</b> obliga a que cualquier figura tenga m√©todos como:
          <code>area()</code>, <code>perimetro()</code>, y getters como <code>get_area()</code>.
        </div>

        <h5 class="fw-bold mb-2">3) Definir la clase abstracta Figura</h5>
        <pre class="code-box mb-2"><code>class Figura(ABC):

    @staticmethod
    def get_form_html() -> str:
        return "..."  # devuelve el formulario HTML como texto

    @abstractmethod
    def area(self) -> None:
        pass

    @abstractmethod
    def perimetro(self) -> None:
        pass

    @abstractmethod
    def get_area(self) -> float:
        pass

    @abstractmethod
    def get_perimetro(self) -> float:
        pass

    @abstractmethod
    def get_tipo(self) -> str:
        pass</code></pre>

        <ul class="mb-3">
          <li><code>Figura(ABC)</code> significa que Figura es abstracta.</li>
          <li><code>@abstractmethod</code> marca m√©todos obligatorios para las clases hijas.</li>
          <li><code>get_form_html()</code> devuelve el formulario para escoger la figura y sus lados.</li>
        </ul>

        <h5 class="fw-bold mb-2">4) Crear las clases hijas (Cuadrado, Rect√°ngulo y Tri√°ngulo)</h5>
        <p class="mb-2">
          Cada clase hija hereda de <code>Figura</code> y debe implementar los m√©todos obligatorios.
          Si no implementa alguno, Python no permitir√° crear objetos de esa clase.
        </p>

        <pre class="code-box mb-2"><code>class Cuadrado(Figura):
    def __init__(self, lado1: float):
        self.tipo = "cuadrado"
        self.lado1 = float(lado1)
        self._a = 0.0
        self._p = 0.0

    def area(self) -> None:
        self._a = self.lado1 ** 2

    def perimetro(self) -> None:
        self._p = self.lado1 * 4</code></pre>

        <div class="alert alert-warning mb-3">
          Nota: en programaci√≥n orientada a objetos, es com√∫n calcular el √°rea y guardarla en una variable privada
          (como <code>self._a</code>) y luego devolverla con <code>get_area()</code>.
        </div>

        <h5 class="fw-bold mb-2">5) Procesar el formulario (POST) y decidir qu√© figura crear</h5>
        <pre class="code-box mb-2"><code>def process_form(form_data: Dict[str, Any]) -> str:
    tipo = (form_data.get("tipo") or "").strip()

    if not tipo:
        return Figura.get_form_html()

    if tipo == "cuadrado":
        l1 = (form_data.get("l1") or "").strip()
        obj = Cuadrado(float(l1))

    elif tipo == "rectangulo":
        l1 = (form_data.get("l1") or "").strip()
        l2 = (form_data.get("l2") or "").strip()
        obj = Rectangulo(float(l1), float(l2))

    elif tipo == "triangulo":
        l1 = (form_data.get("l1") or "").strip()
        l2 = (form_data.get("l2") or "").strip()
        l3 = (form_data.get("l3") or "").strip()
        obj = Triangulo(float(l1), float(l2), float(l3))</code></pre>

        <ul class="mb-3">
          <li>Se lee <code>tipo</code> para saber qu√© figura eligi√≥ el usuario.</li>
          <li>Dependiendo del tipo, se crean objetos: <code>Cuadrado</code>, <code>Rectangulo</code> o <code>Triangulo</code>.</li>
          <li>Luego se llama a <code>obj.area()</code> y <code>obj.perimetro()</code> para calcular.</li>
        </ul>

        <h5 class="fw-bold mb-2">6) Calcular y mostrar resultados</h5>

        <pre class="code-box mb-2"><code>obj.area()
        obj.perimetro()

        resultado = f"""
        &lt;p&gt;&lt;b&gt;Figura:&lt;/b&gt; {obj.get_tipo()}&lt;/p&gt;
        &lt;p&gt;&lt;b&gt;√Årea:&lt;/b&gt; {obj.get_area():.2f}&lt;/p&gt;
        &lt;p&gt;&lt;b&gt;Per√≠metro:&lt;/b&gt; {obj.get_perimetro():.2f}&lt;/p&gt;
        """

        return Figura.get_form_html() + "&lt;hr&gt;" + resultado</code></pre>

        <p class="hint">
          Primero calculamos el √°rea y el per√≠metro. Luego armamos el resultado en un
          <b>f-string multil√≠nea</b> para que el c√≥digo sea m√°s legible y f√°cil de mantener.
        </p>

        <p class="mb-0 hint">
          Mostramos primero el formulario para que el usuario pueda recalcular, y debajo mostramos el resultado.
        </p>
      </div>

      <!-- ‚úÖ Ejecutar -->
      <div class="ej-actions">
        <a href="{{ url_for('ejecutar_ejercicio', slug=ejercicio.slug) }}#formulario"
           class="btn btn-primary btn-pill btn-lg">
          Ejecutar ejercicio
        </a>
      </div>

      <!-- Formulario / salida del ejercicio -->
      {% if contenido %}
      <div id="formulario" class="form-shell">
        <div class="form-card">
          {{ contenido|safe }}
        </div>
      </div>
      {% endif %}

      <!-- ‚úÖ Anterior / Siguiente -->
      <div class="ej-nav-bottom">

        {% if anterior %}
          <a href="{{ url_for('ver_ejercicio', slug=anterior['slug']) }}" class="btn btn-outline-primary btn-pill">
            <i class="bi bi-arrow-left me-1"></i> Anterior
          </a>
        {% else %}
          <button class="btn btn-outline-primary btn-pill" disabled>
            <i class="bi bi-arrow-left me-1"></i> Anterior
          </button>
        {% endif %}

        {% if siguiente %}
          <a href="{{ url_for('ver_ejercicio', slug=siguiente['slug']) }}" class="btn btn-primary btn-pill">
            Siguiente <i class="bi bi-arrow-right ms-1"></i>
          </a>
        {% else %}
          <button class="btn btn-primary btn-pill" disabled>
            Siguiente <i class="bi bi-arrow-right ms-1"></i>
          </button>
        {% endif %}

      </div>

    </div>
  </div>
</section>

{% endblock %}
