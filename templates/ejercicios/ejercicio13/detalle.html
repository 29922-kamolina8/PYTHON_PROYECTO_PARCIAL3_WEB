{% extends "base.html" %}
{% block title %}{{ ejercicio.titulo }} ¬∑ Python Academy{% endblock %}
{% block content %}

<style>
  .hero-ej {
    background: #f8fafc;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    padding: 52px 0;
  }
  .hero-top-actions {
    display: flex;
    justify-content: center;
    margin-bottom: 14px;
  }
  .btn-pill {
    border-radius: 999px;
    padding: 10px 22px;
    font-weight: 700;
  }
  .btn-pill-sm {
    border-radius: 999px;
    padding: 8px 16px;
    font-weight: 700;
  }
  .ej-wrap {
    padding: 36px 0 70px;
  }
  .ej-panel {
    border-radius: 18px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    background: #fff;
    padding: 26px;
  }
  .explain-card {
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 16px;
    padding: 18px;
    background: #fbfdff;
    margin-bottom: 18px;
  }
  .code-box {
    background: #0b1220;
    color: #e6edf3;
    border-radius: 14px;
    padding: 14px;
    overflow: auto;
    font-family: ui-monospace, Menlo, Consolas, monospace;
    font-size: 0.92rem;
    white-space: pre;
  }
  .hint {
    font-size: 0.95rem;
    color: #556;
  }
  .ej-actions {
    margin-top: 18px;
    display: flex;
    justify-content: center;
  }
  .form-shell {
    margin-top: 22px;
    display: flex;
    justify-content: center;
  }
  .form-card {
    width: 100%;
    max-width: 720px;
    border-radius: 18px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
    background: #fff;
    padding: 22px;
  }
  .ej-nav-bottom {
    margin-top: 26px;
    padding-top: 18px;
    border-top: 1px solid rgba(0, 0, 0, 0.08);
    display: flex;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }
</style>

<!-- HERO -->
<section class="hero-ej">
  <div class="container text-center">
    <div class="hero-top-actions">
      <a href="{{ url_for('ejercicios') }}" class="btn btn-outline-secondary btn-pill-sm">
        <i class="bi bi-arrow-left me-1"></i> Volver al men√∫
      </a>
    </div>

    <span class="badge bg-primary mb-3">{{ ejercicio.tema }}</span>
    <h1 class="display-5 mb-2">{{ ejercicio.titulo }}</h1>

    <p class="lead text-muted">
      Programaci√≥n Orientada a Objetos usando clases, atributos,
      m√©todos y constructor en Python.
    </p>
  </div>
</section>

<section class="ej-wrap">
  <div class="container">
    <div class="ej-panel">

      <!-- DEFINICI√ìN -->
      <div class="explain-card">
        <h4 class="fw-bold mb-2">üìò ¬øQu√© es Programaci√≥n Orientada a Objetos?</h4>
        <p>
          La Programaci√≥n Orientada a Objetos (POO) es un paradigma que permite
          modelar problemas del mundo real usando <strong>clases</strong> y
          <strong>objetos</strong>. Cada objeto combina datos (atributos) y
          comportamiento (m√©todos).
        </p>
      </div>

      <!-- ENUNCIADO -->
      <div class="explain-card">
        <h4 class="fw-bold mb-2">üß© Enunciado</h4>
        <p>
          Crear una clase <strong>Figura</strong> que permita calcular el
          <strong>√°rea</strong> y el <strong>per√≠metro</strong> de una figura
          geom√©trica seg√∫n el tipo seleccionado por el usuario
          (cuadrado, rect√°ngulo o tri√°ngulo).
        </p>
      </div>

      <!-- JUSTIFICACI√ìN -->
      <div class="explain-card">
        <h4 class="fw-bold mb-2">üß† ¬øPor qu√© este ejercicio es POO?</h4>
        <ul>
          <li>Se define una <strong>clase</strong> como molde</li>
          <li>Se crean <strong>objetos</strong> a partir de la clase</li>
          <li>Los c√°lculos se encapsulan en <strong>m√©todos</strong></li>
          <li>Los datos se almacenan como <strong>atributos</strong></li>
        </ul>
      </div>

      <!-- EXPLICACI√ìN POR FUNCIONES -->
   
<div class="explain-card mb-4">
  <h4 class="fw-bold mb-3">üìå Explicaci√≥n detallada del c√≥digo (p√°rrafo en p√°rrafo)</h4>

  <!-- 1 -->
  <h5 class="fw-bold">1) Importaci√≥n de librer√≠as necesarias</h5>
  <p>
    <code>import math</code> se utiliza para acceder a funciones matem√°ticas avanzadas,
    espec√≠ficamente <code>sqrt()</code>, que es necesaria para calcular el √°rea del
    tri√°ngulo usando la f√≥rmula de Her√≥n.  
    <code>request</code> permite obtener los datos enviados por el formulario HTML,
    haciendo posible que el usuario ingrese los valores de los lados.
  </p>
  <pre class="code-box">import math
from flask import request</pre>

  <!-- 2 -->
  <h5 class="fw-bold mt-4">2) Definici√≥n de la clase <code>Figura</code></h5>
  <p>
    La clase <code>Figura</code> representa el concepto general de una figura geom√©trica.
    Funciona como un molde que permite crear objetos de tipo cuadrado, rect√°ngulo o
    tri√°ngulo. Esta clase encapsula los datos (lados) y el comportamiento
    (c√°lculo de √°rea y per√≠metro), aplicando Programaci√≥n Orientada a Objetos.
  </p>
  <pre class="code-box">class Figura:</pre>

  <!-- 3 -->
  <h5 class="fw-bold mt-4">3) Constructor de la clase (<code>__init__</code>)</h5>
  <p>
    El constructor se ejecuta autom√°ticamente al crear un objeto. Recibe el tipo
    de figura y los lados necesarios. Dependiendo de la figura, algunos lados pueden
    no existir. Adem√°s, se inicializan las variables de √°rea y per√≠metro en cero,
    preparando el objeto para realizar los c√°lculos posteriormente.
  </p>
  <pre class="code-box">def __init__(self, tipo, l1, l2=None, l3=None):
    self.tipo = tipo
    self.l1 = l1
    self.l2 = l2
    self.l3 = l3
    self.area = 0
    self.perimetro = 0</pre>

  <!-- 4 -->
  <h5 class="fw-bold mt-4">4) M√©todo para calcular el per√≠metro</h5>
  <p>
    Este m√©todo determina el per√≠metro de la figura seg√∫n su tipo.  
    Se utiliza una estructura condicional para aplicar la f√≥rmula correcta:
    cuatro lados iguales para el cuadrado, suma de pares para el rect√°ngulo
    y suma de los tres lados para el tri√°ngulo.  
    El resultado se guarda dentro del objeto.
  </p>
  <pre class="code-box">def calcular_perimetro(self):
    if self.tipo == "cuadrado":
        self.perimetro = self.l1 * 4
    elif self.tipo == "rectangulo":
        self.perimetro = (self.l1 * 2) + (self.l2 * 2)
    elif self.tipo == "triangulo":
        self.perimetro = self.l1 + self.l2 + self.l3
    return self.perimetro</pre>

  <!-- 5 -->
  <h5 class="fw-bold mt-4">5) M√©todo para calcular el √°rea</h5>
  <p>
    El m√©todo <code>calcular_area()</code> obtiene el √°rea dependiendo del tipo de figura.
    Para el cuadrado y rect√°ngulo se aplican f√≥rmulas directas.  
    En el caso del tri√°ngulo, primero se calcula el per√≠metro y luego se aplica
    la f√≥rmula de Her√≥n, lo que demuestra reutilizaci√≥n de m√©todos dentro de la clase.
  </p>
  <pre class="code-box">def calcular_area(self):
    if self.tipo == "cuadrado":
        self.area = self.l1 ** 2
    elif self.tipo == "rectangulo":
        self.area = self.l1 * self.l2
    elif self.tipo == "triangulo":
        self.calcular_perimetro()
        s = self.perimetro / 2
        self.area = math.sqrt(
            s * (s - self.l1) * (s - self.l2) * (s - self.l3)
        )
    return self.area</pre>

  <!-- 6 -->
  <h5 class="fw-bold mt-4">6) Funci√≥n <code>ejecutar()</code> como punto de entrada</h5>
  <p>
    Esta funci√≥n es llamada por la plataforma Flask cuando el usuario presiona
    el bot√≥n ‚ÄúEjecutar ejercicio‚Äù. Act√∫a como puente entre la interfaz (HTML)
    y la l√≥gica en Python. Desde aqu√≠ se controla la lectura de datos,
    la creaci√≥n del objeto y la visualizaci√≥n del resultado.
  </p>
  <pre class="code-box">def ejecutar():</pre>

  <!-- 7 -->
  <h5 class="fw-bold mt-4">7) Lectura de datos enviados por el formulario</h5>
  <p>
    En este bloque se recuperan los valores ingresados por el usuario desde el formulario.
    Dependiendo de la figura seleccionada, se leen uno, dos o tres lados.
    Los valores se convierten a tipo num√©rico para poder realizar c√°lculos matem√°ticos.
  </p>
  <pre class="code-box">tipo = request.form["tipo"]
l1 = float(request.form["lado1"])
l2 = request.form.get("lado2")
l3 = request.form.get("lado3")

l2 = float(l2) if l2 else None
l3 = float(l3) if l3 else None</pre>

  <!-- 8 -->
  <h5 class="fw-bold mt-4">8) Creaci√≥n del objeto Figura</h5>
  <p>
    Aqu√≠ se instancia la clase <code>Figura</code>, creando un objeto real
    a partir de los datos ingresados por el usuario.  
    Este paso es clave porque demuestra c√≥mo la teor√≠a de clases se convierte
    en un objeto funcional que puede ejecutar m√©todos.
  </p>
  <pre class="code-box">figura = Figura(tipo, l1, l2, l3)</pre>

  <!-- 9 -->
  <h5 class="fw-bold mt-4">9) Ejecuci√≥n de m√©todos del objeto</h5>
  <p>
    Una vez creado el objeto, se llaman a sus m√©todos para calcular el √°rea
    y el per√≠metro. Cada m√©todo utiliza los atributos internos del objeto,
    mostrando claramente el uso de encapsulaci√≥n y reutilizaci√≥n de c√≥digo.
  </p>
  <pre class="code-box">area = figura.calcular_area()
perimetro = figura.calcular_perimetro()</pre>

  <!-- 10 -->
  <h5 class="fw-bold mt-4">10) Presentaci√≥n del resultado</h5>
  <p>
    Finalmente, se devuelve un bloque HTML con el resultado del c√°lculo.
    Este resultado se muestra de forma clara y visual al usuario,
    cerrando el ciclo completo: entrada de datos ‚Üí procesamiento ‚Üí salida.
  </p>
  <pre class="code-box">return f"""
<div class='alert alert-success'>
  <h4>Resultado del c√°lculo</h4>
  <p><strong>Figura:</strong> {tipo.capitalize()}</p>
  <p><strong>√Årea:</strong> {area:.2f}</p>
  <p><strong>Per√≠metro:</strong> {perimetro:.2f}</p>
</div>
"""</pre>

</div>


<!-- C√ìDIGO COMPLETO -->
<div class="explain-card mb-4">
  <h4 class="fw-bold">üíª C√≥digo completo del ejercicio (Python)</h4>
  <p class="hint">
    Este c√≥digo corresponde al archivo <code>ejercicio.py</code> completo.
    Implementa Programaci√≥n Orientada a Objetos (POO) para el c√°lculo de √°rea y
    per√≠metro de figuras geom√©tricas.
  </p>

  <pre class="code-box">{% raw %}
import math
from flask import request

# =====================================================
# CLASE FIGURA
# Implementa POO para el c√°lculo de √°rea y per√≠metro
# =====================================================

class Figura:
    def __init__(self, tipo, lado1, lado2=None, lado3=None):
        self.tipo = tipo
        self.lado1 = lado1
        self.lado2 = lado2
        self.lado3 = lado3
        self.area = 0
        self.perimetro = 0

    def calcular_perimetro(self):
        if self.tipo == "cuadrado":
            self.perimetro = self.lado1 * 4

        elif self.tipo == "rectangulo":
            self.perimetro = (self.lado1 * 2) + (self.lado2 * 2)

        elif self.tipo == "triangulo":
            self.perimetro = self.lado1 + self.lado2 + self.lado3

        return self.perimetro

    def calcular_area(self):
        if self.tipo == "cuadrado":
            self.area = self.lado1 ** 2

        elif self.tipo == "rectangulo":
            self.area = self.lado1 * self.lado2

        elif self.tipo == "triangulo":
            self.calcular_perimetro()
            sp = self.perimetro / 2
            self.area = math.sqrt(
                sp * (sp - self.lado1) *
                (sp - self.lado2) *
                (sp - self.lado3)
            )

        return self.area


# =====================================================
# FUNCI√ìN EJECUTAR (PUNTO DE ENTRADA DEL EJERCICIO)
# =====================================================

def ejecutar():

    # ---------------------------------------------
    # GET ‚Üí no ejecuta el ejercicio
    # ---------------------------------------------
    if request.method == "GET":
        return ""

    # ---------------------------------------------
    # POST ‚Üí recibe datos del formulario
    # ---------------------------------------------
    tipo = request.form.get("tipo")
    lado1 = float(request.form.get("lado1"))

    lado2 = request.form.get("lado2")
    lado3 = request.form.get("lado3")

    lado2 = float(lado2) if lado2 else None
    lado3 = float(lado3) if lado3 else None

    # ---------------------------------------------
    # CREACI√ìN DEL OBJETO (POO)
    # ---------------------------------------------
    figura = Figura(tipo, lado1, lado2, lado3)

    area = figura.calcular_area()
    perimetro = figura.calcular_perimetro()

    # ---------------------------------------------
    # SALIDA HTML
    # ---------------------------------------------
    return f"""
    <div class="alert alert-success text-center">
        <h5 class="fw-bold mb-3">Resultado del c√°lculo</h5>

        <p><strong>Figura:</strong> {tipo.capitalize()}</p>
        <p><strong>√Årea:</strong> {area:.2f}</p>
        <p><strong>Per√≠metro:</strong> {perimetro:.2f}</p>
    </div>
    """
{% endraw %}</pre>
</div>
      


<div class="explain-card mb-4">
  <h4 class="fw-bold mb-3">üßÆ Ingreso de datos</h4>

  <form method="post"
        action="{{ url_for('ejecutar_ejercicio', slug=ejercicio.slug) }}#formulario">

    <div class="mb-3">
      <label class="form-label">Tipo de figura</label>
      <select class="form-select" name="tipo" id="tipo" onchange="toggleLados()" required>
        <option value="">Seleccione</option>
        <option value="cuadrado">Cuadrado</option>
        <option value="rectangulo">Rect√°ngulo</option>
        <option value="triangulo">Tri√°ngulo</option>
      </select>
    </div>

    <div class="mb-3">
      <label>Lado 1</label>
      <input type="number" step="any" name="lado1" class="form-control" required>
    </div>

    <div class="mb-3" id="lado2-box" style="display:none;">
      <label>Lado 2</label>
      <input type="number" step="any" name="lado2" class="form-control">
    </div>

    <div class="mb-3" id="lado3-box" style="display:none;">
      <label>Lado 3</label>
      <input type="number" step="any" name="lado3" class="form-control">
    </div>

    <div class="ej-actions">
      <button class="btn btn-primary btn-pill btn-lg">
        Ejecutar ejercicio
      </button>
    </div>
  </form>
</div>

<script>
function toggleLados() {
  const tipo = document.getElementById("tipo").value;
  document.getElementById("lado2-box").style.display =
    (tipo === "rectangulo" || tipo === "triangulo") ? "block" : "none";
  document.getElementById("lado3-box").style.display =
    (tipo === "triangulo") ? "block" : "none";
}
</script>

      </div>


      <!-- RESULTADO -->
      {% if contenido %}
      <div id="formulario" class="form-shell">
        <div class="form-card">
          {{ contenido|safe }}
        </div>
      </div>
      {% endif %}

      <!-- NAVEGACI√ìN -->
      <div class="ej-nav-bottom">
        {% if anterior %}
          <a href="{{ url_for('ver_ejercicio', slug=anterior['slug']) }}"
             class="btn btn-outline-primary btn-pill">
            <i class="bi bi-arrow-left me-1"></i> Anterior
          </a>
        {% endif %}

        {% if siguiente %}
          <a href="{{ url_for('ver_ejercicio', slug=siguiente['slug']) }}"
             class="btn btn-primary btn-pill">
            Siguiente <i class="bi bi-arrow-right ms-1"></i>
          </a>
        {% endif %}
      </div>

    </div>
  </div>
</section>

{% endblock %}
